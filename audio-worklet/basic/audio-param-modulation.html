<!DOCTYPE html>
<html>
<head>
  <title>AudioWorklet AudioParam Modulation | Chrome WebAudio Samples</title>
  <link rel="stylesheet" href="../../resources/base.css">
  <script src="../lib/audio-worklet-base.js"></script>
</head>
<body>
  <a href="../index.html" class="link-small">&#171; AudioWorklet home</a>
  <h1>Demo: AudioParam Modulation</h1>
  <script>
    // Global GC Hack...
    let noiseGain;

    function runDemo() {
      const context = new AudioContext();
      let modulator = new OscillatorNode(context);
      let noiseGenerator = new AudioWorkletNode(context, 'noise-generator');
      noiseGain = noiseGenerator.parameters.get('gain');

      noiseGenerator.connect(context.destination);
      modulator.connect(noiseGain);
      
      modulator.frequency.value = 1;
      modulator.start();
    }
    
    window.addEventListener('load', () => {
      LibAudioWorklet.initializeReporter();
      if (LibAudioWorklet.isAvailable()) {
        LibAudioWorklet.reportMessage('info',
            'AudioWorklet is available. Start running demo...');
        window.audioWorklet.addModule('js/noise-generator.js').then(runDemo);
      } else {
        LibAudioWorklet.reportMessage('error',
            'The browser does not support AudioWorklet yet.');
      }
    });
  </script>
</body>
</html>
